# 批量测试脚本使用说明

## 概述

我为你创建了两个批量测试脚本，可以自动测试指定目录下的所有权重文件：

1. `batch_test.py` - 完整版：测试并保存结果图像
2. `batch_test_simple.py` - 简化版：只计算指标，不保存结果图像

## 使用方法

### 1. 完整版测试（保存结果图像）

```bash
cd /root/autodl-tmp/low-lightSR/IC-600x400/IC-FSRNet
python batch_test.py
```

**功能特点：**
- 测试所有权重文件
- 保存每个模型的结果图像
- 生成详细的测试报告
- 按PSNR排序显示结果

### 2. 简化版测试（只计算指标）

```bash
cd /root/autodl-tmp/low-lightSR/IC-600x400/IC-FSRNet
python batch_test_simple.py
```

**功能特点：**
- 测试所有权重文件
- 只计算PSNR和SSIM指标
- 不保存结果图像（节省存储空间）
- 生成测试总结报告

## 输出结果

### 控制台输出
脚本会显示：
- 测试进度
- 每个模型的PSNR和SSIM值
- 按PSNR排序的最终排名
- 最佳模型信息

### 保存的文件
1. **测试总结JSON文件**：包含所有测试结果的详细信息
2. **结果图像文件夹**（仅完整版）：每个模型的结果图像

## 脚本特点

### 错误处理
- 自动跳过损坏的权重文件
- 显示错误信息但不中断整个测试过程
- 在测试总结中记录失败的模型

### 内存管理
- 每个模型测试后清理GPU内存
- 避免内存溢出问题

### 进度显示
- 使用tqdm显示测试进度
- 实时显示当前测试的模型

## 自定义配置

如果需要修改权重文件目录，可以编辑脚本中的 `model_dir` 变量：

```python
model_dir = "/path/to/your/model/directory"
```

## 测试结果示例

```
==================================================
批量测试完成!
成功测试: 35 个模型
失败测试: 0 个模型

测试结果排名 (按PSNR排序):
--------------------------------------------------------------------------------
排名 模型名称              PSNR     SSIM    
--------------------------------------------------------------------------------
1    epoch_best_539       25.847   0.8234
2    epoch_best_534       25.723   0.8198
3    epoch_best_508       25.689   0.8176
...

最佳模型: epoch_best_539
最佳PSNR: 25.847
最佳SSIM: 0.8234
```

## 注意事项

1. 确保测试数据集路径正确配置
2. 确保有足够的GPU内存
3. 完整版会占用较多存储空间（每个模型的结果图像）
4. 建议先用简化版快速测试，找到最佳模型后再用完整版保存结果

## 故障排除

如果遇到问题：

1. **CUDA内存不足**：减少batch_size或使用简化版
2. **权重文件损坏**：脚本会自动跳过并记录错误
3. **路径错误**：检查权重文件目录路径是否正确 